<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Pengiriman</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            margin-bottom: 30px;
            color: #333;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-tabs {
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-area {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Mobile Dashboard */
        .mobile-dashboard {
            display: none;
        }

        .mobile-header {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .mobile-menu {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .mobile-menu-item {
            padding: 15px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mobile-menu-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Status Badges */
        .badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h2>üöö Sistem Manajemen Pengiriman</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" required>
                </div>
                <div class="form-group">
                    <label>Login Sebagai</label>
                    <select id="userRole">
                        <option value="admin">Admin</option>
                        <option value="operator">Operator</option>
                        <option value="driver">Driver</option>
                    </select>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Login</button>
            </form>
            <p style="margin-top: 20px; text-align: center; color: #666; font-size: 14px;">
                Demo: admin/admin, operator/operator, driver/driver
            </p>
        </div>
    </div>

    <!-- Admin/Operator Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="container">
            <div class="header">
                <div>
                    <h1>üöö Sistem Manajemen Pengiriman</h1>
                </div>
                <div class="user-info">
                    <span id="userDisplay"></span>
                    <button onclick="logout()" class="btn btn-secondary">Logout</button>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('overview')">üìä Overview</button>
                <button class="nav-tab" onclick="switchTab('orders')">üì¶ Data Order</button>
                <button class="nav-tab" onclick="switchTab('vehicles')">üöõ Master Kendaraan</button>
                <button class="nav-tab" onclick="switchTab('checkin')">‚úÖ Status Check-In</button>
                <button class="nav-tab" onclick="switchTab('assign')">üìã Assign Delivery</button>
                <button class="nav-tab" onclick="switchTab('tracking')">üìç Status Pengiriman</button>
            </div>

            <div class="content-area">
                <!-- Overview Tab -->
                <div id="overview" class="tab-content active">
                    <h2>Dashboard Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Orders</div>
                            <div class="stat-value" id="totalOrders">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Active Deliveries</div>
                            <div class="stat-value" id="activeDeliveries">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Available Trucks</div>
                            <div class="stat-value" id="availableTrucks">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Completed Today</div>
                            <div class="stat-value" id="completedToday">0</div>
                        </div>
                    </div>
                    <h3>Recent Activities</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Activity</th>
                                <th>User</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivities">
                            <tr>
                                <td colspan="4" style="text-align: center;">No activities yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Orders Tab -->
                <div id="orders" class="tab-content">
                    <h2>Data Order</h2>
                    <button onclick="showAddOrderModal()" class="btn">+ Tambah Order</button>
                    <div class="file-upload" onclick="document.getElementById('excelFile').click()">
                        <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleExcelUpload(event)">
                        <p>üìÅ Click to upload Excel file</p>
                        <small>Support: .xlsx, .xls, .csv</small>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Address</th>
                                <th>Items</th>
                                <th>Weight (kg)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                        </tbody>
                    </table>
                </div>

                <!-- Vehicles Tab -->
                <div id="vehicles" class="tab-content">
                    <h2>Master Data Kendaraan</h2>
                    <button onclick="showAddVehicleModal()" class="btn">+ Tambah Kendaraan</button>
                    <table>
                        <thead>
                            <tr>
                                <th>Vehicle ID</th>
                                <th>Plate Number</th>
                                <th>Type</th>
                                <th>Capacity (kg)</th>
                                <th>Driver</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="vehiclesTable">
                        </tbody>
                    </table>
                </div>

                <!-- Check-in Status Tab -->
                <div id="checkin" class="tab-content">
                    <h2>Status Truck Check-In</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Vehicle ID</th>
                                <th>Plate Number</th>
                                <th>Driver</th>
                                <th>Check-In Time</th>
                                <th>Status</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody id="checkinTable">
                        </tbody>
                    </table>
                </div>

                <!-- Assign Delivery Tab -->
                <div id="assign" class="tab-content">
                    <h2>Assign Delivery Order</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Select Order</label>
                            <select id="selectOrder">
                                <option value="">-- Select Order --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Select Available Vehicle</label>
                            <select id="selectVehicle">
                                <option value="">-- Select Vehicle --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button onclick="assignDelivery()" class="btn">Assign Delivery</button>
                        </div>
                    </div>
                    <h3>Current Assignments</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Assignment ID</th>
                                <th>Order ID</th>
                                <th>Vehicle</th>
                                <th>Driver</th>
                                <th>Assigned Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentsTable">
                        </tbody>
                    </table>
                </div>

                <!-- Tracking Tab -->
                <div id="tracking" class="tab-content">
                    <h2>Status Pengiriman</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Delivery ID</th>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Vehicle</th>
                                <th>Driver</th>
                                <th>Status</th>
                                <th>Last Update</th>
                            </tr>
                        </thead>
                        <tbody id="trackingTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Dashboard for Drivers -->
    <div id="mobileDashboard" class="mobile-dashboard">
        <div class="container">
            <div class="mobile-header">
                <h2>üöö Driver Dashboard</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                    <span id="driverName"></span>
                    <button onclick="logout()" class="btn btn-secondary">Logout</button>
                </div>
            </div>

            <div id="driverMenu" class="mobile-menu">
                <div class="mobile-menu-item" onclick="driverCheckIn()">
                    ‚úÖ Check In
                </div>
                <div class="mobile-menu-item" onclick="showMyDeliveries()">
                    üì¶ My Deliveries
                </div>
                <div class="mobile-menu-item" onclick="showUpdateDelivery()">
                    üìç Update Delivery Status
                </div>
            </div>

            <div id="driverContent" class="mobile-menu" style="display: none;">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addOrderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Order</h3>
                <span class="close-modal" onclick="closeModal('addOrderModal')">&times;</span>
            </div>
            <form id="addOrderForm">
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>Delivery Address</label>
                    <textarea id="deliveryAddress" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                </div>
                <div class="form-group">
                    <label>Items</label>
                    <input type="text" id="orderItems" required>
                </div>
                <div class="form-group">
                    <label>Weight (kg)</label>
                    <input type="number" id="orderWeight" required>
                </div>
                <button type="submit" class="btn">Add Order</button>
            </form>
        </div>
    </div>

    <div id="addVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Vehicle</h3>
                <span class="close-modal" onclick="closeModal('addVehicleModal')">&times;</span>
            </div>
            <form id="addVehicleForm">
                <div class="form-group">
                    <label>Plate Number</label>
                    <input type="text" id="plateNumber" required>
                </div>
                <div class="form-group">
                    <label>Vehicle Type</label>
                    <select id="vehicleType" required>
                        <option value="Pickup">Pickup Truck</option>
                        <option value="Box">Box Truck</option>
                        <option value="Container">Container Truck</option>
                        <option value="Van">Van</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Capacity (kg)</label>
                    <input type="number" id="vehicleCapacity" required>
                </div>
                <div class="form-group">
                    <label>Driver Name</label>
                    <input type="text" id="driverNameInput" required>
                </div>
                <button type="submit" class="btn">Add Vehicle</button>
            </form>
        </div>
    </div>

    <script>
        // Database Simulation using localStorage
        class Database {
            constructor() {
                this.initializeData();
            }

            initializeData() {
                if (!localStorage.getItem('users')) {
                    const users = [
                        { username: 'admin', password: 'admin', role: 'admin', name: 'Admin User' },
                        { username: 'operator', password: 'operator', role: 'operator', name: 'Operator User' },
                        { username: 'driver', password: 'driver', role: 'driver', name: 'John Driver', vehicleId: 'V001' },
                        { username: 'driver2', password: 'driver2', role: 'driver', name: 'Jane Driver', vehicleId: 'V002' }
                    ];
                    localStorage.setItem('users', JSON.stringify(users));
                }

                if (!localStorage.getItem('orders')) {
                    const orders = [
                        {
                            id: 'ORD001',
                            customer: 'PT ABC Indonesia',
                            address: 'Jl. Sudirman No. 123, Jakarta',
                            items: 'Electronics',
                            weight: 150,
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'ORD002',
                            customer: 'CV XYZ Trading',
                            address: 'Jl. Gatot Subroto No. 456, Jakarta',
                            items: 'Furniture',
                            weight: 300,
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        }
                    ];
                    localStorage.setItem('orders', JSON.stringify(orders));
                }

                if (!localStorage.getItem('vehicles')) {
                    const vehicles = [
                        {
                            id: 'V001',
                            plateNumber: 'B 1234 ABC',
                            type: 'Box',
                            capacity: 1000,
                            driver: 'John Driver',
                            status: 'available',
                            checkedIn: false
                        },
                        {
                            id: 'V002',
                            plateNumber: 'B 5678 XYZ',
                            type: 'Container',
                            capacity: 2000,
                            driver: 'Jane Driver',
                            status: 'available',
                            checkedIn: false
                        }
                    ];
                    localStorage.setItem('vehicles', JSON.stringify(vehicles));
                }

                if (!localStorage.getItem('assignments')) {
                    localStorage.setItem('assignments', JSON.stringify([]));
                }

                if (!localStorage.getItem('deliveries')) {
                    localStorage.setItem('deliveries', JSON.stringify([]));
                }

                if (!localStorage.getItem('activities')) {
                    localStorage.setItem('activities', JSON.stringify([]));
                }
            }

            getUsers() {
                return JSON.parse(localStorage.getItem('users') || '[]');
            }

            getOrders() {
                return JSON.parse(localStorage.getItem('orders') || '[]');
            }

            setOrders(orders) {
                localStorage.setItem('orders', JSON.stringify(orders));
            }

            getVehicles() {
                return JSON.parse(localStorage.getItem('vehicles') || '[]');
            }

            setVehicles(vehicles) {
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
            }

            getAssignments() {
                return JSON.parse(localStorage.getItem('assignments') || '[]');
            }

            setAssignments(assignments) {
                localStorage.setItem('assignments', JSON.stringify(assignments));
            }

            getDeliveries() {
                return JSON.parse(localStorage.getItem('deliveries') || '[]');
            }

            setDeliveries(deliveries) {
                localStorage.setItem('deliveries', JSON.stringify(deliveries));
            }

            getActivities() {
                return JSON.parse(localStorage.getItem('activities') || '[]');
            }

            addActivity(activity) {
                const activities = this.getActivities();
                activities.unshift({
                    ...activity,
                    time: new Date().toLocaleString()
                });
                localStorage.setItem('activities', JSON.stringify(activities.slice(0, 50)));
            }
        }

        const db = new Database();
        let currentUser = null;

        // Login Function
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('userRole').value;

            const users = db.getUsers();
            const user = users.find(u => u.username === username && u.password === password && u.role === role);

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                db.addActivity({
                    activity: 'User logged in',
                    user: user.name,
                    status: 'success'
                });

                if (role === 'driver') {
                    showDriverDashboard();
                } else {
                    showAdminDashboard();
                }
            } else {
                alert('Invalid credentials!');
            }
        });

        function showAdminDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('mobileDashboard').style.display = 'none';
            document.getElementById('userDisplay').textContent = `üë§ ${currentUser.name} (${currentUser.role})`;
            
            loadDashboardData();
        }

        function showDriverDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('mobileDashboard').style.display = 'block';
            document.getElementById('driverName').textContent = `üë§ ${currentUser.name}`;
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('mobileDashboard').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for the tab
            switch(tabName) {
                case 'overview':
                    loadOverview();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'vehicles':
                    loadVehicles();
                    break;
                case 'checkin':
                    loadCheckinStatus();
                    break;
                case 'assign':
                    loadAssignments();
                    break;
                case 'tracking':
                    loadTracking();
                    break;
            }
        }

        function loadDashboardData() {
            loadOverview();
            loadOrders();
            loadVehicles();
            loadAssignments();
        }

        function loadOverview() {
            const orders = db.getOrders();
            const vehicles = db.getVehicles();
            const deliveries = db.getDeliveries();
            const activities = db.getActivities();

            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('availableTrucks').textContent = vehicles.filter(v => v.status === 'available').length;
            document.getElementById('activeDeliveries').textContent = deliveries.filter(d => d.status === 'in_transit').length;
            document.getElementById('completedToday').textContent = deliveries.filter(d => {
                return d.status === 'delivered' && new Date(d.updatedAt).toDateString() === new Date().toDateString();
            }).length;

            // Load recent activities
            const activitiesHtml = activities.slice(0, 10).map(activity => `
                <tr>
                    <td>${activity.time}</td>
                    <td>${activity.activity}</td>
                    <td>${activity.user}</td>
                    <td><span class="badge badge-${activity.status === 'success' ? 'success' : 'info'}">${activity.status}</span></td>
                </tr>
            `).join('');

            document.getElementById('recentActivities').innerHTML = activitiesHtml || '<tr><td colspan="4" style="text-align: center;">No activities yet</td></tr>';
        }

        function loadOrders() {
            const orders = db.getOrders();
            const ordersHtml = orders.map(order => `
                <tr>
                    <td>${order.id}</td>
                    <td>${order.customer}</td>
                    <td>${order.address}</td>
                    <td>${order.items}</td>
                    <td>${order.weight}</td>
                    <td><span class="badge badge-${getStatusBadgeClass(order.status)}">${order.status}</span></td>
                    <td>
                        <button onclick="deleteOrder('${order.id}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('ordersTable').innerHTML = ordersHtml || '<tr><td colspan="7" style="text-align: center;">No orders found</td></tr>';

            // Update select options for assignment
            const selectOrder = document.getElementById('selectOrder');
            selectOrder.innerHTML = '<option value="">-- Select Order --</option>' + 
                orders.filter(o => o.status === 'pending').map(order => 
                    `<option value="${order.id}">${order.id} - ${order.customer}</option>`
                ).join('');
        }

        function loadVehicles() {
            const vehicles = db.getVehicles();
            const vehiclesHtml = vehicles.map(vehicle => `
                <tr>
                    <td>${vehicle.id}</td>
                    <td>${vehicle.plateNumber}</td>
                    <td>${vehicle.type}</td>
                    <td>${vehicle.capacity}</td>
                    <td>${vehicle.driver}</td>
                    <td><span class="badge badge-${getStatusBadgeClass(vehicle.status)}">${vehicle.status}</span></td>
                    <td>
                        <button onclick="deleteVehicle('${vehicle.id}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('vehiclesTable').innerHTML = vehiclesHtml || '<tr><td colspan="7" style="text-align: center;">No vehicles found</td></tr>';

            // Update select options for assignment
            const selectVehicle = document.getElementById('selectVehicle');
            selectVehicle.innerHTML = '<option value="">-- Select Vehicle --</option>' + 
                vehicles.filter(v => v.status === 'available' && v.checkedIn).map(vehicle => 
                    `<option value="${vehicle.id}">${vehicle.plateNumber} - ${vehicle.type} (${vehicle.capacity}kg)</option>`
                ).join('');
        }

        function loadCheckinStatus() {
            const vehicles = db.getVehicles();
            const checkinHtml = vehicles.filter(v => v.checkedIn).map(vehicle => `
                <tr>
                    <td>${vehicle.id}</td>
                    <td>${vehicle.plateNumber}</td>
                    <td>${vehicle.driver}</td>
                    <td>${vehicle.checkinTime || 'N/A'}</td>
                    <td><span class="badge badge-success">Checked In</span></td>
                    <td>${vehicle.location || 'Depot'}</td>
                </tr>
            `).join('');

            document.getElementById('checkinTable').innerHTML = checkinHtml || '<tr><td colspan="6" style="text-align: center;">No vehicles checked in</td></tr>';
        }

        function loadAssignments() {
            const assignments = db.getAssignments();
            const assignmentsHtml = assignments.map(assignment => `
                <tr>
                    <td>${assignment.id}</td>
                    <td>${assignment.orderId}</td>
                    <td>${assignment.vehiclePlate}</td>
                    <td>${assignment.driver}</td>
                    <td>${assignment.assignedTime}</td>
                    <td><span class="badge badge-${getStatusBadgeClass(assignment.status)}">${assignment.status}</span></td>
                </tr>
            `).join('');

            document.getElementById('assignmentsTable').innerHTML = assignmentsHtml || '<tr><td colspan="6" style="text-align: center;">No assignments found</td></tr>';
        }

        function loadTracking() {
            const deliveries = db.getDeliveries();
            const trackingHtml = deliveries.map(delivery => `
                <tr>
                    <td>${delivery.id}</td>
                    <td>${delivery.orderId}</td>
                    <td>${delivery.customer}</td>
                    <td>${delivery.vehiclePlate}</td>
                    <td>${delivery.driver}</td>
                    <td><span class="badge badge-${getStatusBadgeClass(delivery.status)}">${delivery.status}</span></td>
                    <td>${new Date(delivery.updatedAt).toLocaleString()}</td>
                </tr>
            `).join('');

            document.getElementById('trackingTable').innerHTML = trackingHtml || '<tr><td colspan="7" style="text-align: center;">No deliveries found</td></tr>';
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending': return 'warning';
                case 'assigned': return 'info';
                case 'in_transit': return 'info';
                case 'delivered': return 'success';
                case 'available': return 'success';
                case 'busy': return 'warning';
                default: return 'secondary';
            }
        }

        // Modal Functions
        function showAddOrderModal() {
            document.getElementById('addOrderModal').style.display = 'flex';
        }

        function showAddVehicleModal() {
            document.getElementById('addVehicleModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Add Order
        document.getElementById('addOrderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const orders = db.getOrders();
            const newOrder = {
                id: 'ORD' + String(orders.length + 1).padStart(3, '0'),
                customer: document.getElementById('customerName').value,
                address: document.getElementById('deliveryAddress').value,
                items: document.getElementById('orderItems').value,
                weight: parseFloat(document.getElementById('orderWeight').value),
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            orders.push(newOrder);
            db.setOrders(orders);
            
            db.addActivity({
                activity: 'New order added: ' + newOrder.id,
                user: currentUser.name,
                status: 'success'
            });

            closeModal('addOrderModal');
            loadOrders();
            loadOverview();
            this.reset();
        });

        // Add Vehicle
        document.getElementById('addVehicleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const vehicles = db.getVehicles();
            const newVehicle = {
                id: 'V' + String(vehicles.length + 1).padStart(3, '0'),
                plateNumber: document.getElementById('plateNumber').value,
                type: document.getElementById('vehicleType').value,
                capacity: parseFloat(document.getElementById('vehicleCapacity').value),
                driver: document.getElementById('driverNameInput').value,
                status: 'available',
                checkedIn: false
            };

            vehicles.push(newVehicle);
            db.setVehicles(vehicles);
            
            db.addActivity({
                activity: 'New vehicle added: ' + newVehicle.plateNumber,
                user: currentUser.name,
                status: 'success'
            });

            closeModal('addVehicleModal');
            loadVehicles();
            loadOverview();
            this.reset();
        });

        // Delete Functions
        function deleteOrder(orderId) {
            if (confirm('Are you sure you want to delete this order?')) {
                const orders = db.getOrders();
                const filtered = orders.filter(o => o.id !== orderId);
                db.setOrders(filtered);
                
                db.addActivity({
                    activity: 'Order deleted: ' + orderId,
                    user: currentUser.name,
                    status: 'success'
                });

                loadOrders();
                loadOverview();
            }
        }

        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                const vehicles = db.getVehicles();
                const filtered = vehicles.filter(v => v.id !== vehicleId);
                db.setVehicles(filtered);
                
                db.addActivity({
                    activity: 'Vehicle deleted: ' + vehicleId,
                    user: currentUser.name,
                    status: 'success'
                });

                loadVehicles();
                loadOverview();
            }
        }

        // Assign Delivery
        function assignDelivery() {
            const orderId = document.getElementById('selectOrder').value;
            const vehicleId = document.getElementById('selectVehicle').value;

            if (!orderId || !vehicleId) {
                alert('Please select both order and vehicle!');
                return;
            }

            const orders = db.getOrders();
            const vehicles = db.getVehicles();
            const assignments = db.getAssignments();
            const deliveries = db.getDeliveries();

            const order = orders.find(o => o.id === orderId);
            const vehicle = vehicles.find(v => v.id === vehicleId);

            if (!order || !vehicle) {
                alert('Invalid selection!');
                return;
            }

            // Update order status
            order.status = 'assigned';
            db.setOrders(orders);

            // Update vehicle status
            vehicle.status = 'busy';
            db.setVehicles(vehicles);

            // Create assignment
            const newAssignment = {
                id: 'ASG' + String(assignments.length + 1).padStart(3, '0'),
                orderId: order.id,
                vehicleId: vehicle.id,
                vehiclePlate: vehicle.plateNumber,
                driver: vehicle.driver,
                assignedTime: new Date().toLocaleString(),
                status: 'active'
            };
            assignments.push(newAssignment);
            db.setAssignments(assignments);

            // Create delivery record
            const newDelivery = {
                id: 'DEL' + String(deliveries.length + 1).padStart(3, '0'),
                orderId: order.id,
                customer: order.customer,
                address: order.address,
                vehicleId: vehicle.id,
                vehiclePlate: vehicle.plateNumber,
                driver: vehicle.driver,
                status: 'assigned',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            deliveries.push(newDelivery);
            db.setDeliveries(deliveries);

            db.addActivity({
                activity: `Order ${orderId} assigned to ${vehicle.plateNumber}`,
                user: currentUser.name,
                status: 'success'
            });

            alert('Delivery assigned successfully!');
            loadAssignments();
            loadOrders();
            loadVehicles();
            loadOverview();
        }

        // Driver Functions
        function driverCheckIn() {
            const vehicles = db.getVehicles();
            const vehicle = vehicles.find(v => v.driver === currentUser.name);
            
            if (vehicle) {
                vehicle.checkedIn = true;
                vehicle.checkinTime = new Date().toLocaleString();
                vehicle.location = 'Depot';
                db.setVehicles(vehicles);

                db.addActivity({
                    activity: `Driver ${currentUser.name} checked in`,
                    user: currentUser.name,
                    status: 'success'
                });

                alert('Check-in successful!');
                showDriverStatus();
            } else {
                alert('No vehicle assigned to you!');
            }
        }

        function showDriverStatus() {
            const vehicles = db.getVehicles();
            const vehicle = vehicles.find(v => v.driver === currentUser.name);
            
            document.getElementById('driverMenu').style.display = 'none';
            document.getElementById('driverContent').style.display = 'block';
            
            document.getElementById('driverContent').innerHTML = `
                <h3>Check-In Status</h3>
                <p><strong>Vehicle:</strong> ${vehicle ? vehicle.plateNumber : 'Not assigned'}</p>
                <p><strong>Status:</strong> <span class="badge badge-success">Checked In</span></p>
                <p><strong>Time:</strong> ${vehicle ? vehicle.checkinTime : 'N/A'}</p>
                <button onclick="backToDriverMenu()" class="btn btn-secondary">Back to Menu</button>
            `;
        }

        function showMyDeliveries() {
            const deliveries = db.getDeliveries();
            const myDeliveries = deliveries.filter(d => d.driver === currentUser.name);
            
            document.getElementById('driverMenu').style.display = 'none';
            document.getElementById('driverContent').style.display = 'block';
            
            const deliveriesHtml = myDeliveries.map(delivery => `
                <div style="background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 5px;">
                    <p><strong>Delivery ID:</strong> ${delivery.id}</p>
                    <p><strong>Customer:</strong> ${delivery.customer}</p>
                    <p><strong>Address:</strong> ${delivery.address}</p>
                    <p><strong>Status:</strong> <span class="badge badge-${getStatusBadgeClass(delivery.status)}">${delivery.status}</span></p>
                </div>
            `).join('');

            document.getElementById('driverContent').innerHTML = `
                <h3>My Deliveries</h3>
                ${deliveriesHtml || '<p>No deliveries assigned to you.</p>'}
                <button onclick="backToDriverMenu()" class="btn btn-secondary">Back to Menu</button>
            `;
        }

        function showUpdateDelivery() {
            const deliveries = db.getDeliveries();
            const myDeliveries = deliveries.filter(d => d.driver === currentUser.name && d.status !== 'delivered');
            
            document.getElementById('driverMenu').style.display = 'none';
            document.getElementById('driverContent').style.display = 'block';
            
            const deliveriesOptions = myDeliveries.map(delivery => 
                `<option value="${delivery.id}">${delivery.id} - ${delivery.customer}</option>`
            ).join('');

            document.getElementById('driverContent').innerHTML = `
                <h3>Update Delivery Status</h3>
                <div class="form-group">
                    <label>Select Delivery</label>
                    <select id="driverSelectDelivery">
                        <option value="">-- Select Delivery --</option>
                        ${deliveriesOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label>Update Status</label>
                    <select id="driverUpdateStatus">
                        <option value="in_transit">In Transit</option>
                        <option value="delivered">Delivered</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes (optional)</label>
                    <textarea id="driverNotes" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                </div>
                <button onclick="updateDeliveryStatus()" class="btn">Update Status</button>
                <button onclick="backToDriverMenu()" class="btn btn-secondary" style="margin-left: 10px;">Back to Menu</button>
            `;
        }

        function updateDeliveryStatus() {
            const deliveryId = document.getElementById('driverSelectDelivery').value;
            const newStatus = document.getElementById('driverUpdateStatus').value;
            const notes = document.getElementById('driverNotes').value;

            if (!deliveryId) {
                alert('Please select a delivery!');
                return;
            }

            const deliveries = db.getDeliveries();
            const delivery = deliveries.find(d => d.id === deliveryId);

            if (delivery) {
                delivery.status = newStatus;
                delivery.updatedAt = new Date().toISOString();
                delivery.notes = notes;

                // If delivered, update vehicle status
                if (newStatus === 'delivered') {
                    const vehicles = db.getVehicles();
                    const vehicle = vehicles.find(v => v.id === delivery.vehicleId);
                    if (vehicle) {
                        vehicle.status = 'available';
                        db.setVehicles(vehicles);
                    }

                    // Update order status
                    const orders = db.getOrders();
                    const order = orders.find(o => o.id === delivery.orderId);
                    if (order) {
                        order.status = 'delivered';
                        db.setOrders(orders);
                    }
                }

                db.setDeliveries(deliveries);

                db.addActivity({
                    activity: `Delivery ${deliveryId} status updated to ${newStatus}`,
                    user: currentUser.name,
                    status: 'success'
                });

                alert('Delivery status updated successfully!');
                showMyDeliveries();
            }
        }

        function backToDriverMenu() {
            document.getElementById('driverMenu').style.display = 'block';
            document.getElementById('driverContent').style.display = 'none';
        }

        // Excel Upload Handler
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Simulate Excel parsing (in real app, use libraries like SheetJS)
            alert('Excel file uploaded: ' + file.name + '\nNote: In production, this would parse the Excel file and import orders.');
            
            // Demo: Add sample orders from "Excel"
            const orders = db.getOrders();
            const excelOrders = [
                {
                    id: 'ORD' + String(orders.length + 1).padStart(3, '0'),
                    customer: 'Imported Customer 1',
                    address: 'Address from Excel 1',
                    items: 'Imported Items',
                    weight: 200,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'ORD' + String(orders.length + 2).padStart(3, '0'),
                    customer: 'Imported Customer 2',
                    address: 'Address from Excel 2',
                    items: 'Imported Items',
                    weight: 150,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];

            orders.push(...excelOrders);
            db.setOrders(orders);

            db.addActivity({
                activity: 'Imported orders from Excel: ' + file.name,
                user: currentUser.name,
                status: 'success'
            });

            loadOrders();
            loadOverview();
            event.target.value = '';
        }

        // Check for existing session
        window.addEventListener('load', function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.role === 'driver') {
                    showDriverDashboard();
                } else {
                    showAdminDashboard();
                }
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>